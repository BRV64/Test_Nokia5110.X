/*******************************************************************************
 *
 *                  XC8_004: LCD Nokia 5110
 *
 *******************************************************************************
 * FileName:        main.c
 * Processor:       PIC18F25K22
 * Complier:        XC8 v1.30
 * Author:          Pedro Sánchez (MrChunckuee)
 * Blog:            http://mrchunckuee.blogspot.com/
 * Email:           mrchunckuee.psr@gmail.com
 * Description:     Probando libreria para LCD Nokia5110, para cambiar la
 *                  distribucion de pines modificar en PCD8544.h
 *******************************************************************************
 * Rev.         Date            Comment
 *   v1.00      20/02/2016      Creación del firmware
 ******************************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <xc.h>
#include "Alteri.h" //Only here
#include "PCD8544.h"
//#include "font_pattern.h"

//#define _XTAL_FREQ 8000000

const unsigned char EYR_ImageLogo[] = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0x60, 0xF0, 0x90, 0x18, 0x18, 0x18, 0x18, 0x18,
0x30, 0x70, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0x60, 0xF0, 0x98, 0x18, 0x18, 0x18,
0x18, 0x18, 0x30, 0x70, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0xC0, 0xE0, 0x30, 0x38, 0x6C, 0x0E, 0x1B, 0x13, 0xC7, 0xC6, 0x70, 0x30, 0x1C,
0x0C, 0x04, 0x00, 0x00, 0x80, 0xE0, 0x70, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xE0, 0x30, 0x38, 0x6C, 0x4E, 0x1B, 0x13, 0xC7, 0xC6, 0x70,
0x31, 0x1C, 0x0C, 0x04, 0x00, 0x80, 0xC0, 0xE0, 0x70, 0x1F, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x80, 0xE0, 0x7C, 0x0F, 0x00, 0x30, 0x30, 0x1C, 0x8C, 0x87, 0x83, 0x81,
0xC0, 0xC0, 0x70, 0x30, 0x1C, 0x0C, 0x06, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xE0, 0x7C, 0x0F, 0x01, 0x30, 0x30, 0x1C, 0x8C, 0x87,
0x83, 0x81, 0xC0, 0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x38, 0x7C, 0x66, 0x73, 0x79, 0x3C, 0x1E, 0x0F, 0x07, 0x03, 0x03, 0x01,
0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x66, 0x73, 0x79, 0x3C, 0x1E, 0x0F, 0x07, 0x03,
0x03, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x40, 0x40, 0xC0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x0E, 0x15, 0x15, 0x06,
0x00, 0x00, 0x1E, 0x01, 0x01, 0x00, 0x1E, 0x01, 0x01, 0x1E, 0x01, 0x01, 0x1E, 0x00, 0x00, 0x0E,
0x11, 0x11, 0x0E, 0x00, 0x00, 0x1E, 0x01, 0x01, 0x1E, 0x01, 0x01, 0x1E, 0x00, 0x00, 0x0E, 0x15,
0x15, 0x06, 0x00, 0x01, 0x0F, 0x11, 0x00, 0x00, 0x1E, 0x01, 0x01, 0x00, 0x0E, 0x11, 0x11, 0x0E,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
};

unsigned char DISPLAY_COUNT[4];
unsigned int ACC;

void MCU_Init(void);
//void Delay_ms(unsigned int t);
void MCU_MensajeInicio(void);
void MCU_DisplayUpdate(void);

void main(void){
    MCU_Init();
    EYRLCD_Init();
    EYRLCD_Clear();
    delay_ms(10);
    ACC=0;
    MCU_MensajeInicio();
    while(1){
        ACC++;
        if (ACC>1234){
            DISPLAY_COUNT[0]='0';
            DISPLAY_COUNT[1]='0';
            DISPLAY_COUNT[2]='0';
            DISPLAY_COUNT[3]='0';
            ACC=0;
        }
        itoa(DISPLAY_COUNT, ACC, 10);
        MCU_DisplayUpdate();
        delay_ms(200);
    }
}

void MCU_Init(void){
    ADCON0=0x00; //all digital
    ADCON1=0x00; //all digital
    ADCON1bits.PCFG=0x0F;
    //ANSELC=0x00; //all digital
    //OSCCONbits.IRCF=0b110; //Fosc=8MHz
    TRISB=0x00; //PORTB output
}

void MCU_MensajeInicio(void){
   //Mensaje de inicio
    EYRLCD_Bitmap(EYR_ImageLogo, 0, 0);
    delay_ms(3000);
    EYRLCD_Clear();
    EYRLCD_WriteString("Libreria LCD", 0, 0);
    EYRLCD_WriteString("Nokia 5110", 0, 9);
    EYRLCD_WriteString("Contador", 0, 18);
    EYRLCD_WriteString("MrChunckuee", 0, 27);
    EYRLCD_WriteString("MPLABX & XC8", 0, 36);
    delay_ms(3000);
    DISPLAY_COUNT[0]='0';
    DISPLAY_COUNT[1]='0';
    DISPLAY_COUNT[2]='0';
    DISPLAY_COUNT[3]='0';
    EYRLCD_Clear();
}

void MCU_DisplayUpdate(void){
    EYRLCD_Clear();
    EYRLCD_WriteString("Conteo:", 0, 0);
    if (ACC<10){
            EYRLCD_GotoXY(0, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[0]);
        }
        else if (ACC>=10 && ACC<100){
            EYRLCD_GotoXY(0, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[0]);
            EYRLCD_GotoXY(10, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[1]);
        }
        else if(ACC >=100 && ACC<1000){
            EYRLCD_GotoXY(0, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[0]);
            EYRLCD_GotoXY(10, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[1]);
            EYRLCD_GotoXY(20, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[2]);
        }
        else if(ACC>=1000){
            EYRLCD_GotoXY(0, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[0]);
            EYRLCD_GotoXY(10, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[1]);
            EYRLCD_GotoXY(20, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[2]);
            EYRLCD_GotoXY(30, 10);
            EYRLCD_WriteByte(DISPLAY_COUNT[3]);
        }
}

